// Generated by CoffeeScript 1.4.0
var convert, exec, fs, path, spawn, _ref;

global.show = console.log;

global.error = function(x) {
  throw new Error(x);
};

fs = require('fs');

path = require('path');

_ref = require('child_process'), exec = _ref.exec, spawn = _ref.spawn;

convert = require('./guil.js').convert;

process.argv.slice(2).forEach(function(filename) {
  var basename, dirname, extname, fullpath, here, new_name, op, run;
  show(filename);
  if (filename == null) {
    error('Missing filename!');
  }
  extname = path.extname(filename);
  if (extname !== '.guil') {
    error('wrong extname!' + extname);
  }
  if (filename[0] === '/') {
    fullpath = filename;
  } else {
    here = process.env.PWD;
    fullpath = path.join(here, filename);
  }
  dirname = path.dirname(fullpath);
  basename = path.basename(fullpath, '.guil');
  new_name = path.join(dirname, basename + '.scm');
  (run = function() {
    var file;
    file = fs.readFileSync(fullpath, 'utf8');
    file = convert(file);
    show('reload');
    return fs.writeFile(new_name, file, 'utf8');
  })();
  op = {
    interval: 100
  };
  return fs.watchFile(fullpath, op, run);
});
